services:
  # åç«¯å¤§è„‘ï¼šä¸å†å¯¹å…¬ç½‘å¼€æ”¾ 8000 ç«¯å£
  backend:
    build: ./backend
    # ports åˆ æ‰ï¼Œä¸è®©å¤–é¢ç›´æ¥è®¿é—®
    env_file: ./backend/.env
    volumes:
      - ./backend:/app

  # å‰ç«¯ç•Œé¢ï¼šä¸å†å¯¹å…¬ç½‘å¼€æ”¾ 3000 ç«¯å£
  frontend:
    build: ./frontend
    # ports åˆ æ‰ï¼Œåªå…è®¸ä»£ç†è®¿é—®
    env_file: ./frontend/.env
    depends_on:
      - backend
    volumes:
      - ./frontend:/app
      - /app/node_modules

  # æ–°å¢çš„â€œå®‰å…¨å²—äº­â€ï¼šå”¯ä¸€å¯¹å¤–å¼€æ”¾çš„å…¥å£
 # æ–°å¢çš„â€œå®‰å…¨å²—äº­â€ï¼šå”¯ä¸€å¯¹å¤–å¼€æ”¾çš„å…¥å£
 # æ–°å¢çš„â€œå®‰å…¨å²—äº­â€
  oauth2-proxy:
    image: quay.io/oauth2-proxy/oauth2-proxy:latest
    ports:
      - "4180:4180"
    environment:
      OAUTH2_PROXY_PROVIDER: "github"
      # ğŸ‘‡ ç›´æ¥å¡«å…¥æ‚¨çš„çœŸå®å€¼ï¼Œä¸ç•™ç©ºæ ¼ï¼Œä¹Ÿä¸è¦ç”¨ ${}
      OAUTH2_PROXY_CLIENT_ID: "Ov23liTE9YmgNwykYGhm"
      OAUTH2_PROXY_CLIENT_SECRET: "8cb126b4fb8c5c10302c7e289fd8114cf828a795"
      OAUTH2_PROXY_COOKIE_SECRET: "12345678901234567890123456789012"
      
      # å¿…å¡«ï¼šç›‘å¬æ‰€æœ‰ç½‘ç»œ
      OAUTH2_PROXY_HTTP_ADDRESS: "0.0.0.0:4180"
      
      OAUTH2_PROXY_UPSTREAMS: "http://frontend:3000"
      OAUTH2_PROXY_REDIRECT_URL: "http://localhost:4180/oauth2/callback"
      OAUTH2_PROXY_EMAIL_DOMAINS: "*"
      OAUTH2_PROXY_PASS_USER_HEADERS: "true"
      # è®¾ç½® X-Auth-Request-Email ç­‰ Header
      OAUTH2_PROXY_SET_XAUTHREQUEST: "true"
      # (å¯é€‰) å¦‚æœæ‚¨å¸Œæœ›åç«¯èƒ½æ‹¿åˆ° GitHub çš„åŸå§‹ Token
      OAUTH2_PROXY_PASS_ACCESS_TOKEN: "true"
    depends_on:
      - frontend
      - backend